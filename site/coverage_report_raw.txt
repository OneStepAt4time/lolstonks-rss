============================= test session starts =============================
platform win32 -- Python 3.10.4, pytest-7.4.3, pluggy-1.6.0 -- C:\Users\manus\AppData\Local\Programs\Python\Python310\python.exe
cachedir: .pytest_cache
rootdir: D:\lolstonksrss
configfile: pytest.ini
testpaths: tests
plugins: anyio-3.7.1, logfire-4.16.0, asyncio-0.21.1, cov-4.1.0, mock-3.15.1
asyncio: mode=auto
collecting ... collected 151 items

tests/test_api.py::test_root_endpoint PASSED                             [  0%]
tests/test_api.py::test_health_check_healthy PASSED                      [  1%]
tests/test_api.py::test_health_check_no_articles PASSED                  [  1%]
tests/test_api.py::test_get_main_feed PASSED                             [  2%]
tests/test_api.py::test_get_main_feed_with_limit PASSED                  [  3%]
tests/test_api.py::test_get_main_feed_limit_capped PASSED                [  3%]
tests/test_api.py::test_get_source_feed_en PASSED                        [  4%]
tests/test_api.py::test_get_source_feed_it PASSED                        [  5%]
tests/test_api.py::test_get_source_feed_invalid PASSED                   [  5%]
tests/test_api.py::test_get_source_feed_with_limit PASSED                [  6%]
tests/test_api.py::test_get_category_feed PASSED                         [  7%]
tests/test_api.py::test_get_category_feed_with_limit PASSED              [  7%]
tests/test_api.py::test_refresh_endpoint PASSED                          [  8%]
tests/test_api.py::test_cors_headers PASSED                              [  9%]
tests/test_api.py::test_cache_control_headers PASSED                     [  9%]
tests/test_api.py::test_content_type_headers PASSED                      [ 10%]
tests/test_api.py::test_feed_error_handling PASSED                       [ 11%]
tests/test_api.py::test_service_not_initialized PASSED                   [ 11%]
tests/test_api.py::test_docs_endpoint PASSED                             [ 12%]
tests/test_api.py::test_openapi_schema PASSED                            [ 13%]
tests/test_api_client.py::TestGetBuildId::test_get_build_id_success PASSED [ 13%]
tests/test_api_client.py::TestGetBuildId::test_get_build_id_cached PASSED [ 14%]
tests/test_api_client.py::TestGetBuildId::test_get_build_id_not_found PASSED [ 15%]
tests/test_api_client.py::TestGetBuildId::test_get_build_id_http_error PASSED [ 15%]
tests/test_api_client.py::TestGetBuildId::test_get_build_id_different_locales PASSED [ 16%]
tests/test_api_client.py::TestFetchNews::test_fetch_news_success PASSED  [ 17%]
tests/test_api_client.py::TestFetchNews::test_fetch_news_404_retry PASSED [ 17%]
tests/test_api_client.py::TestFetchNews::test_fetch_news_it_locale PASSED [ 18%]
tests/test_api_client.py::TestFetchNews::test_fetch_news_http_error PASSED [ 19%]
tests/test_api_client.py::TestFetchNews::test_fetch_news_empty_response PASSED [ 19%]
tests/test_api_client.py::TestParseArticles::test_parse_articles_success PASSED [ 20%]
tests/test_api_client.py::TestParseArticles::test_parse_articles_no_article_grid PASSED [ 21%]
tests/test_api_client.py::TestParseArticles::test_parse_articles_malformed_data PASSED [ 21%]
tests/test_api_client.py::TestParseArticles::test_parse_articles_partial_failure PASSED [ 22%]
tests/test_api_client.py::TestTransformToArticle::test_transform_basic_article PASSED [ 23%]
tests/test_api_client.py::TestTransformToArticle::test_transform_youtube_article PASSED [ 23%]
tests/test_api_client.py::TestTransformToArticle::test_transform_italian_article PASSED [ 24%]
tests/test_api_client.py::TestTransformToArticle::test_transform_missing_optional_fields PASSED [ 25%]
tests/test_api_client.py::TestTransformToArticle::test_transform_missing_url PASSED [ 25%]
tests/test_api_client.py::TestTransformToArticle::test_transform_missing_publish_date PASSED [ 26%]
tests/test_api_client.py::TestTransformToArticle::test_transform_date_format PASSED [ 27%]
tests/test_api_client.py::TestCacheIntegration::test_cache_isolation_between_locales PASSED [ 27%]
tests/test_api_client.py::TestCacheIntegration::test_cache_invalidation PASSED [ 28%]
tests/test_cache.py::test_cache_set_and_get PASSED                       [ 29%]
tests/test_cache.py::test_cache_get_nonexistent PASSED                   [ 29%]
tests/test_cache.py::test_cache_expiration PASSED                        [ 30%]
tests/test_cache.py::test_cache_custom_ttl PASSED                        [ 31%]
tests/test_cache.py::test_cache_clear PASSED                             [ 31%]
tests/test_cache.py::test_cache_cleanup_expired PASSED                   [ 32%]
tests/test_cache.py::test_cache_different_types PASSED                   [ 33%]
tests/test_database.py::test_database_initialization PASSED              [ 33%]
tests/test_database.py::test_save_article PASSED                         [ 34%]
tests/test_database.py::test_save_duplicate_article PASSED               [ 35%]
tests/test_database.py::test_save_many_articles PASSED                   [ 35%]
tests/test_database.py::test_save_many_with_duplicates PASSED            [ 36%]
tests/test_database.py::test_get_by_guid PASSED                          [ 37%]
tests/test_database.py::test_get_by_guid_not_found PASSED                [ 37%]
tests/test_database.py::test_get_latest PASSED                           [ 38%]
tests/test_database.py::test_get_latest_with_source_filter PASSED        [ 39%]
tests/test_feed_service.py::test_feed_service_initialization PASSED      [ 39%]
tests/test_feed_service.py::test_get_main_feed PASSED                    [ 40%]
tests/test_feed_service.py::test_get_main_feed_with_limit PASSED         [ 41%]
tests/test_feed_service.py::test_feed_caching PASSED                     [ 41%]
tests/test_feed_service.py::test_different_limits_different_cache PASSED [ 42%]
tests/test_feed_service.py::test_get_feed_by_source_en PASSED            [ 43%]
tests/test_feed_service.py::test_get_feed_by_source_it PASSED            [ 43%]
tests/test_feed_service.py::test_get_feed_by_source_caching PASSED       [ 44%]
tests/test_feed_service.py::test_get_feed_by_category PASSED             [ 45%]
tests/test_feed_service.py::test_get_feed_by_category_filters_correctly PASSED [ 45%]
tests/test_feed_service.py::test_get_feed_by_category_caching PASSED     [ 46%]
tests/test_feed_service.py::test_invalidate_cache PASSED                 [ 47%]
tests/test_feed_service.py::test_empty_articles_list PASSED              [ 47%]
tests/test_feed_service.py::test_multiple_categories_per_article PASSED  [ 48%]
tests/test_feed_service.py::test_feed_service_with_custom_cache_ttl PASSED [ 49%]
tests/test_feed_service.py::test_concurrent_requests PASSED              [ 49%]
tests/test_feed_service.py::test_feed_url_in_output PASSED               [ 50%]
tests/test_feed_service.py::test_category_feed_with_no_matches PASSED    [ 50%]
tests/test_feed_service.py::test_source_feed_with_no_articles PASSED     [ 51%]
tests/test_feed_service.py::test_feed_service_uses_config_settings PASSED [ 52%]
tests/test_feed_service.py::test_cache_keys_are_unique PASSED            [ 52%]
tests/test_integration_scheduler.py::test_scheduler_full_integration PASSED [ 53%]
tests/test_integration_scheduler.py::test_update_service_with_real_repository PASSED [ 54%]
tests/test_integration_scheduler.py::test_scheduler_lifecycle PASSED     [ 54%]
tests/test_integration_scheduler.py::test_repository_database_operations PASSED [ 55%]
tests/test_models.py::test_article_creation PASSED                       [ 56%]
tests/test_models.py::test_article_minimal_creation PASSED               [ 56%]
tests/test_models.py::test_article_validation_empty_title PASSED         [ 57%]
tests/test_models.py::test_article_validation_empty_url PASSED           [ 58%]
tests/test_models.py::test_article_validation_empty_guid PASSED          [ 58%]
tests/test_models.py::test_article_to_dict PASSED                        [ 59%]
tests/test_models.py::test_article_from_dict PASSED                      [ 60%]
tests/test_models.py::test_article_from_dict_empty_categories PASSED     [ 60%]
tests/test_models.py::test_article_roundtrip PASSED                      [ 61%]
tests/test_models.py::test_article_source_enum PASSED                    [ 62%]
tests/test_rss_generator.py::test_rss_generator_initialization PASSED    [ 62%]
tests/test_rss_generator.py::test_rss_generator_custom_initialization PASSED [ 63%]
tests/test_rss_generator.py::test_generate_feed_basic PASSED             [ 64%]
tests/test_rss_generator.py::test_generate_feed_validation PASSED        [ 64%]
tests/test_rss_generator.py::test_generate_feed_entry_content PASSED     [ 65%]
tests/test_rss_generator.py::test_generate_feed_with_image PASSED        [ 66%]
tests/test_rss_generator.py::test_generate_feed_without_image PASSED     [ 66%]
tests/test_rss_generator.py::test_generate_feed_with_categories PASSED   [ 67%]
tests/test_rss_generator.py::test_generate_feed_by_source PASSED         [ 68%]
tests/test_rss_generator.py::test_generate_feed_by_category PASSED       [ 68%]
tests/test_rss_generator.py::test_generate_feed_multiple_categories PASSED [ 69%]
tests/test_rss_generator.py::test_empty_articles_list PASSED             [ 70%]
tests/test_rss_generator.py::test_italian_language_generator PASSED      [ 70%]
tests/test_rss_generator.py::test_article_without_optional_fields PASSED [ 71%]
tests/test_rss_generator.py::test_feed_date_format PASSED                [ 72%]
tests/test_rss_generator.py::test_feed_content_html PASSED               [ 72%]
tests/test_rss_generator.py::test_feed_self_link PASSED                  [ 73%]
tests/test_rss_generator.py::test_timezone_aware_dates PASSED            [ 74%]
tests/test_rss_generator.py::test_generate_feed_preserves_title PASSED   [ 74%]
tests/test_scheduler.py::test_scheduler_initialization PASSED            [ 75%]
tests/test_scheduler.py::test_scheduler_start PASSED                     [ 76%]
tests/test_scheduler.py::test_scheduler_start_already_running PASSED     [ 76%]
tests/test_scheduler.py::test_scheduler_stop PASSED                      [ 77%]
tests/test_scheduler.py::test_scheduler_stop_not_running PASSED          [ 78%]
tests/test_scheduler.py::test_manual_trigger PASSED                      [ 78%]
tests/test_scheduler.py::test_manual_trigger_with_error PASSED           [ 79%]
tests/test_scheduler.py::test_get_status_not_running PASSED              [ 80%]
tests/test_scheduler.py::test_get_status_running PASSED                  [ 80%]
tests/test_scheduler.py::test_update_job_success PASSED                  [ 81%]
tests/test_scheduler.py::test_update_job_error PASSED                    [ 82%]
tests/test_scheduler.py::test_scheduler_with_custom_interval PASSED      [ 82%]
tests/test_scheduler.py::test_scheduler_prevents_overlapping_jobs PASSED [ 83%]
tests/test_scheduler.py::test_scheduler_integration_with_update_service PASSED [ 84%]
tests/test_scheduler.py::test_scheduler_job_configuration PASSED         [ 84%]
tests/test_update_service.py::test_update_service_initialization PASSED  [ 85%]
tests/test_update_service.py::test_update_all_sources PASSED             [ 86%]
tests/test_update_service.py::test_update_all_sources_with_duplicates PASSED [ 86%]
tests/test_update_service.py::test_update_all_sources_with_errors PASSED [ 87%]
tests/test_update_service.py::test_get_status PASSED                     [ 88%]
tests/test_update_service.py::test_get_status_after_update PASSED        [ 88%]
tests/test_update_service.py::test_update_source_logging PASSED          [ 89%]
tests/e2e/test_full_workflow.py::test_complete_workflow_memory_database PASSED [ 90%]
tests/e2e/test_full_workflow.py::test_multi_source_workflow PASSED       [ 90%]
tests/integration/test_api_integration.py::test_fetch_real_en_us_news PASSED [ 91%]
tests/integration/test_api_integration.py::test_fetch_real_it_it_news PASSED [ 92%]
tests/integration/test_api_integration.py::test_buildid_caching PASSED   [ 92%]
tests/integration/test_api_integration.py::test_multiple_locales PASSED  [ 93%]
tests/integration/test_server_integration.py::test_full_server_workflow PASSED [ 94%]
tests/integration/test_server_integration.py::test_server_with_real_data PASSED [ 94%]
tests/integration/test_server_integration.py::test_concurrent_requests PASSED [ 95%]
tests/integration/test_server_integration.py::test_cache_invalidation PASSED [ 96%]
tests/integration/test_server_integration.py::test_error_recovery PASSED [ 96%]
tests/performance/test_performance.py::test_feed_generation_performance PASSED [ 97%]
tests/performance/test_performance.py::test_database_query_performance PASSED [ 98%]
tests/validation/test_rss_compliance.py::test_rss_20_version_compliance PASSED [ 98%]
tests/validation/test_rss_compliance.py::test_required_channel_elements PASSED [ 99%]
tests/validation/test_rss_compliance.py::test_xml_well_formed PASSED     [100%]

============================== warnings summary ===============================
C:\Users\manus\AppData\Local\Programs\Python\Python310\lib\site-packages\starlette\formparsers.py:10
  C:\Users\manus\AppData\Local\Programs\Python\Python310\lib\site-packages\starlette\formparsers.py:10: PendingDeprecationWarning: Please use `import python_multipart` instead.
    import multipart

C:\Users\manus\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\_internal\_config.py:271
  C:\Users\manus\AppData\Local\Programs\Python\Python310\lib\site-packages\pydantic\_internal\_config.py:271: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

tests/test_scheduler.py::test_scheduler_start
tests/test_scheduler.py::test_scheduler_start_already_running
tests/test_scheduler.py::test_scheduler_stop
tests/test_scheduler.py::test_get_status_running
tests/test_scheduler.py::test_scheduler_with_custom_interval
tests/test_scheduler.py::test_scheduler_prevents_overlapping_jobs
tests/test_scheduler.py::test_scheduler_job_configuration
  C:\Users\manus\AppData\Local\Programs\Python\Python310\lib\site-packages\apscheduler\schedulers\asyncio.py:35: DeprecationWarning: There is no current event loop
    self._eventloop = asyncio.get_event_loop()

tests/integration/test_server_integration.py::test_cache_invalidation
  D:\lolstonksrss\src\api\app.py:318: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
    service.invalidate_cache()
  Enable tracemalloc to get traceback where the object was allocated.
  See https://docs.pytest.org/en/stable/how-to/capture-warnings.html#resource-warnings for more info.

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform win32, python 3.10.4-final-0 -----------
Name                             Stmts   Miss  Cover   Missing
--------------------------------------------------------------
src\__init__.py                      1      0   100%
src\api\__init__.py                  2      0   100%
src\api\app.py                     114     38    67%   42-71, 225-227, 264-266, 284, 298-300, 322-324, 339-343, 360-365
src\api_client.py                   98      6    94%   134-136, 177-179
src\config.py                       31      0   100%
src\database.py                     56      0   100%
src\models.py                       32      0   100%
src\rss\__init__.py                  3      0   100%
src\rss\feed_service.py             54      0   100%
src\rss\generator.py                64      0   100%
src\services\__init__.py             3      0   100%
src\services\scheduler.py           48      0   100%
src\services\update_service.py      55      2    96%   122-123
src\utils\__init__.py                0      0   100%
src\utils\cache.py                  41      0   100%
--------------------------------------------------------------
TOTAL                              602     46    92%
Coverage HTML written to dir htmlcov

Required test coverage of 90% reached. Total coverage: 92.36%
====================== 151 passed, 10 warnings in 19.26s ======================
